"""
–¢–µ—Å—Ç —É–ª—É—á—à–µ–Ω–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
"""
from message_extractor import MessageExtractor
from datetime import datetime

# –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –†–ê–ë–û–¢–û–î–ê–¢–ï–õ–ï–ô (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å employer)
EMPLOYER_MESSAGES = [
    "–ù—É–∂–Ω—ã —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –Ω–∞ –ø–≤–∑ WB. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ –≥—Ä–∞—Ñ–∏–∫–∞–º 2/2, 3/3, 5/2. –ú–æ—Å–∫–≤–∞ 16+. –°—Ç–∞–≤–∫–∞ –æ—Ç 5000",
    "–ù—É–∂–Ω—ã –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –Ω–∞ –ø–≤–∑!!! –í–æ–∑–º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ 2/2, 3/3, 5/2. –ú–æ—Å–∫–≤–∞ 16+ –ª–µ—Ç",
    "–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä –Ω–∞ –ø–≤–∑ –û–ó–û–ù. –ó—è–±–ª–∏–∫–æ–≤–æ/–î–æ–º–æ–¥–µ–¥–æ–≤—Å–∫–∞—è. –ì—Ä–∞—Ñ–∏–∫ 2/2 —Å 10-22",
    "–¢—Ä–µ–±—É—é—Ç—Å—è 2 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å—Ç—Ä–æ–≥–æ —Å –æ–ø—ã—Ç–æ–º –Ω–∞ –ü–í–ó. –ú.–°–ø–∞—Ä—Ç–∞–∫. –ì—Ä–∞—Ñ–∏–∫ 2/2",
    "–ò—â—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ –∑–∞–º–µ–Ω—É, –ú—ã—Ç–∏—â–∏, 20 —Ñ–µ–≤—Ä–∞–ª—è, 2800",
    "–ù—É–∂–µ–Ω —Ä–∞–±–æ—Ç–Ω–∏–∫ –≤ –ü–í–ó, –∑–∞–≤—Ç—Ä–∞, –æ–ø–ª–∞—Ç–∞ 3000 —Ä, —à–∫ - 200",
    "–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É",
    "–ò—â–µ–º —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ —Å –æ–ø—ã—Ç–æ–º –Ω–∞ –ø–≤–∑",
    "–ù—É–∂–Ω–∞ –¥–µ–≤–æ—á–∫–∞ –Ω–∞ –∑–∞–º–µ–Ω—É, –∑–∞–≤—Ç—Ä–∞",
    "–¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è, —Å—Ç–∞–≤–∫–∞ 3000"
]

# –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –†–ê–ë–û–¢–ù–ò–ö–û–í (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å worker)
WORKER_MESSAGES = [
    "–ì–æ—Ç–æ–≤ –≤—ã–π—Ç–∏ —Å–µ–≥–æ–¥–Ω—è, —Ü–µ–Ω–∞ –∑–∞ —Å–º–µ–Ω—É 3000",
    "–í—ã–π–¥—É –Ω–∞ –∑–∞–º–µ–Ω—É, –∑–∞–≤—Ç—Ä–∞, –æ–ø–ª–∞—Ç–∞ 2500 —Ä—É–±",
    "–ú–æ–≥—É 15 —Ñ–µ–≤—Ä–∞–ª—è, 2800‚ÇΩ, —à–∫ - 100",
    "–í—ã–π–¥—É –Ω–∞ —Å–º–µ–Ω—É –∑–∞–≤—Ç—Ä–∞, –æ–∑–æ–Ω, –æ–ø—ã—Ç –≥–æ–¥, –≤–± - –æ–ø—ã—Ç –¥–≤–∞ –≥–æ–¥–∞",
    "–ò—â—É —Ä–∞–±–æ—Ç—É –Ω–∞ –ø–≤–∑, –µ—Å—Ç—å –æ–ø—ã—Ç 2 –≥–æ–¥–∞",
    "–í–æ–∑—å–º—É —Å–º–µ–Ω—É –Ω–∞ –∑–∞–≤—Ç—Ä–∞, –ú–æ—Å–∫–≤–∞",
    "–†–∞—Å—Å–º–æ—Ç—Ä—é –≤–∞—Ä–∏–∞–Ω—Ç—ã, —Ä–∞–±–æ—Ç–∞–ª –Ω–∞ –ø–≤–∑ –æ–∑–æ–Ω",
    "–í—ã—Ö–æ–∂—É –Ω–∞ –∑–∞–º–µ–Ω—É, –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞, 3500"
]

# –°–ü–û–†–ù–´–ï —Å–ª—É—á–∞–∏ (–º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–±–∞ —Ç–∏–ø–∞ —Å–ª–æ–≤)
AMBIGUOUS_MESSAGES = [
    "–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ –ø–≤–∑",  # –†–∞–±–æ—Ç–Ω–∏–∫ –∏—â–µ—Ç —Ä–∞–±–æ—Ç—É (–ù–û "—Ç—Ä–µ–±—É–µ—Ç—Å—è" –∑–≤—É—á–∏—Ç –∫–∞–∫ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å)
]


def test_classification():
    """–¢–µ—Å—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤"""
    print("=" * 80)
    print("–¢–ï–°–¢ –ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–ò –¢–ò–ü–û–í –°–û–û–ë–©–ï–ù–ò–ô")
    print("=" * 80)
    print()

    # –¢–µ—Å—Ç 1: –†–ê–ë–û–¢–û–î–ê–¢–ï–õ–ò
    print("1Ô∏è‚É£  –¢–µ—Å—Ç: –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –†–ê–ë–û–¢–û–î–ê–¢–ï–õ–ï–ô")
    print()

    employer_correct = 0
    employer_total = len(EMPLOYER_MESSAGES)

    for msg in EMPLOYER_MESSAGES:
        detected_type = MessageExtractor.detect_type(msg)

        if detected_type == "employer":
            print(f"   ‚úÖ EMPLOYER: {msg[:60]}...")
            employer_correct += 1
        else:
            print(f"   ‚ùå {detected_type or 'UNKNOWN'}: {msg[:60]}...")
            print(f"      üí° –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: employer")

    print()
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {employer_correct}/{employer_total} –ø—Ä–∞–≤–∏–ª—å–Ω–æ ({employer_correct/employer_total*100:.1f}%)")
    print()

    # –¢–µ—Å—Ç 2: –†–ê–ë–û–¢–ù–ò–ö–ò
    print("2Ô∏è‚É£  –¢–µ—Å—Ç: –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –†–ê–ë–û–¢–ù–ò–ö–û–í")
    print()

    worker_correct = 0
    worker_total = len(WORKER_MESSAGES)

    for msg in WORKER_MESSAGES:
        detected_type = MessageExtractor.detect_type(msg)

        if detected_type == "worker":
            print(f"   ‚úÖ WORKER: {msg[:60]}...")
            worker_correct += 1
        else:
            print(f"   ‚ùå {detected_type or 'UNKNOWN'}: {msg[:60]}...")
            print(f"      üí° –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: worker")

    print()
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {worker_correct}/{worker_total} –ø—Ä–∞–≤–∏–ª—å–Ω–æ ({worker_correct/worker_total*100:.1f}%)")
    print()

    # –¢–µ—Å—Ç 3: –°–ü–û–†–ù–´–ï
    if AMBIGUOUS_MESSAGES:
        print("3Ô∏è‚É£  –¢–µ—Å—Ç: –°–ø–æ—Ä–Ω—ã–µ —Å–ª—É—á–∞–∏ (—Ç—Ä–µ–±—É—é—Ç –∞–Ω–∞–ª–∏–∑–∞)")
        print()

        for msg in AMBIGUOUS_MESSAGES:
            detected_type = MessageExtractor.detect_type(msg)
            print(f"   ü§î {detected_type or 'UNKNOWN'}: {msg[:60]}...")

        print()

    # –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    print("=" * 80)
    print("–ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢")
    print("=" * 80)
    print()

    total_correct = employer_correct + worker_correct
    total_messages = employer_total + worker_total
    accuracy = total_correct / total_messages * 100

    print(f"üìä –¢–æ—á–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏: {total_correct}/{total_messages} ({accuracy:.1f}%)")
    print()

    if accuracy == 100:
        print("üéâ –û–¢–õ–ò–ß–ù–û! –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ!")
    elif accuracy >= 90:
        print("‚úÖ –•–û–†–û–®–û! –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ")
    else:
        print("‚ö†Ô∏è  –¢–†–ï–ë–£–ï–¢–°–Ø –£–õ–£–ß–®–ï–ù–ò–ï! –ú–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏")

    print()
    print("üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
    print("   - Employer keywords –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ü–ï–†–í–´–ú–ò (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)")
    print("   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–ª–æ–≤–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è")
    print("   - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Å–ª–æ–≤–∞ –ø–æ–º–æ–≥–∞—é—Ç —Ä–∞–∑–ª–∏—á–∞—Ç—å —Ç–∏–ø—ã")
    print()

    return accuracy == 100


if __name__ == "__main__":
    success = test_classification()
    exit(0 if success else 1)
