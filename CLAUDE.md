üìã –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï: WORKERS_SERVICE
üéØ –ß–¢–û –°–û–ó–î–ê–Å–ú
–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö Telegram —á–∞—Ç–æ–≤ –∏ –ø–æ–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ —Ä–∞–±–æ—Ç–µ –Ω–∞ –ü–í–ó (–ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏ –∑–∞–∫–∞–∑–æ–≤).
–í–∞–∂–Ω–æ: –≠—Ç–æ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å REST API. Telegram –±–æ—Ç (ParserHub) –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø–æ–∑–∂–µ ‚Äî —Å–µ–π—á–∞—Å –æ–Ω –ù–ï –Ω—É–∂–µ–Ω. –ú—ã —Å–æ–∑–¥–∞—ë–º —Ç–æ–ª—å–∫–æ API, –∫–æ—Ç–æ—Ä—ã–π –±–æ—Ç –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å.

üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (FastAPI –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å)
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:
workers_service/
‚îú‚îÄ‚îÄ api.py                 ‚Üê FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + endpoints
‚îú‚îÄ‚îÄ models_api.py          ‚Üê Pydantic –º–æ–¥–µ–ª–∏ (Request/Response)
‚îú‚îÄ‚îÄ models_db.py           ‚Üê –ú–æ–¥–µ–ª–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ parser.py              ‚Üê –ü–∞—Ä—Å–∏–Ω–≥ Telegram —á–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ message_extractor.py   ‚Üê –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–µ–∫—Å—Ç–∞ (regex)
‚îú‚îÄ‚îÄ filters.py             ‚Üê –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π
‚îú‚îÄ‚îÄ db_service.py          ‚Üê –†–∞–±–æ—Ç–∞ —Å SQLite
‚îú‚îÄ‚îÄ tg_notifier.py         ‚Üê –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram
‚îú‚îÄ‚îÄ state_manager.py       ‚Üê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–∞–¥–∞—á (task_id)
‚îú‚îÄ‚îÄ tasks.py               ‚Üê –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (threading)
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:
FastAPI          ‚Äî REST API
python-telegram-bot  ‚Äî –ß—Ç–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω—ã—Ö Telegram –∫–∞–Ω–∞–ª–æ–≤
SQLite           ‚Äî –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
Regex            ‚Äî –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–µ–∫—Å—Ç–∞ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ!)
Pydantic         ‚Äî –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
Threading        ‚Äî –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
Loguru           ‚Äî –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

üéØ –¶–ï–õ–¨ –°–ï–†–í–ò–°–ê
–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å 10-20 –ø—É–±–ª–∏—á–Ω—ã—Ö Telegram —á–∞—Ç–æ–≤ (–∫–∞–Ω–∞–ª–æ–≤), –∏—Å–∫–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
–¢–∏–ø 1: –û—Ç —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ (–∏—â—É—Ç —Ä–∞–±–æ—Ç—É)
"–ì–æ—Ç–æ–≤ –≤—ã–π—Ç–∏ —Å–µ–≥–æ–¥–Ω—è, —Ü–µ–Ω–∞ –∑–∞ —Å–º–µ–Ω—É 3000"
"–í—ã–π–¥—É –Ω–∞ –∑–∞–º–µ–Ω—É, –∑–∞–≤—Ç—Ä–∞, –æ–ø–ª–∞—Ç–∞ 2500"
"–ú–æ–≥—É 15 —Ñ–µ–≤—Ä–∞–ª—è, 2800 —Ä—É–±, —à–∫ - 100"
–¢–∏–ø 2: –û—Ç —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–π (–∏—â—É—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤)
"–ò—â—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ –∑–∞–º–µ–Ω—É, –ú—ã—Ç–∏—â–∏, 20 —Ñ–µ–≤—Ä–∞–ª—è, 2800"
"–ù—É–∂–µ–Ω —Ä–∞–±–æ—Ç–Ω–∏–∫ –≤ –ü–í–ó, –∑–∞–≤—Ç—Ä–∞, –æ–ø–ª–∞—Ç–∞ 3000, —à–∫ - 200"
–ò–∑–≤–ª–µ–∫–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –µ–≥–æ –ª–∏—á–Ω—ã–π Telegram –±–æ—Ç.

üìä –î–ê–ù–ù–´–ï –î–õ–Ø –ò–ó–í–õ–ï–ß–ï–ù–ò–Ø
–ü–æ–ª—è (—Ä–∞–±–æ—Ç–Ω–∏–∫/—Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å):
–ü–æ–ª–µ–¢–∏–ø–ü—Ä–∏–º–µ—Ä–ü—Ä–∏–º–µ—á–∞–Ω–∏—èauthor_usernamestring"@ivan_petrov"–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æauthor_full_namestring"–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤"–ï—Å–ª–∏ –µ—Å—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª–µdatedate2026-02-15–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æpriceint3000–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (—Ä—É–±/—Å–º–µ–Ω–∞)shkstring"100" / "–º–∞–ª–æ"–ï—Å–ª–∏ —É–ø–æ–º—è–Ω—É—Ç–ælocationstring"–ú—ã—Ç–∏—â–∏"–ï—Å–ª–∏ —É–ø–æ–º—è–Ω—É—Ç–æmessage_textstring–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æmessage_linkstringt.me/chat/123–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æchat_namestring"@pvz_workers"–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æmessage_datedatetime2026-02-01 14:30–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
–®–ö (—à–∫) ‚Äî –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–π —Ç–µ—Ä–º–∏–Ω –∏–∑ —á–∞—Ç–æ–≤ ("—à–∫ - 100", "—à–∫ –º–∞–ª–æ"), –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤/–∑–∞–∫–∞–∑–æ–≤. –ü—Ä–æ—Å—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç.

üîç –ò–ó–í–õ–ï–ß–ï–ù–ò–ï –î–ê–ù–ù–´–• (REGEX)
–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞:
–†–∞–±–æ—Ç–Ω–∏–∫:

"–ì–æ—Ç–æ–≤ –≤—ã–π—Ç–∏", "–í—ã–π–¥—É", "–ú–æ–≥—É", "–†–∞–±–æ—Ç–∞ –ü–í–ó", "–ò—â—É —Ä–∞–±–æ—Ç—É", "–í–æ–∑—å–º—É —Å–º–µ–Ω—É"

–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å:

"–ò—â—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞", "–ù—É–∂–µ–Ω —Ä–∞–±–æ—Ç–Ω–∏–∫", "–¢—Ä–µ–±—É–µ—Ç—Å—è", "–ò—â—É –Ω–∞ –∑–∞–º–µ–Ω—É", "–ù—É–∂–Ω–∞ –¥–µ–≤–æ—á–∫–∞/–ø–∞—Ä–µ–Ω—å"

–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã (–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏):
python# "—Å–µ–≥–æ–¥–Ω—è" ‚Üí –¥–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
# "–∑–∞–≤—Ç—Ä–∞" ‚Üí –¥–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è + 1 –¥–µ–Ω—å
# "–ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞" ‚Üí –¥–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è + 2 –¥–Ω—è
# "15 —Ñ–µ–≤—Ä–∞–ª—è" ‚Üí 2026-02-15 (–≥–æ–¥ = —Ç–µ–∫—É—â–∏–π)
# "15.02" ‚Üí 2026-02-15
# "15/02" ‚Üí 2026-02-15
–ü—Ä–∏–º–µ—Ä regex –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:
python# –¶–µ–Ω–∞
r'(\d{4,5})\s*(?:—Ä—É–±|‚ÇΩ|—Ä)'
r'(?:—Ü–µ–Ω–∞|–æ–ø–ª–∞—Ç–∞|–∑–ø)\s*(\d{4,5})'

# –®–ö
r'—à–∫\s*[-:‚Äî]\s*(\d+)'
r'—à–∫\s*[-:‚Äî]\s*(–º–∞–ª–æ|–º–Ω–æ–≥–æ|—Å—Ä–µ–¥–Ω–µ)'

# –î–∞—Ç–∞
r'(\d{1,2})\s*(?:—è–Ω–≤–∞—Ä—è|—Ñ–µ–≤—Ä–∞–ª—è|–º–∞—Ä—Ç–∞|...)'
r'(\d{1,2})\.(\d{1,2})'
–¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ regex):
pythontest_messages = [
    "–ì–æ—Ç–æ–≤ –≤—ã–π—Ç–∏ —Å–µ–≥–æ–¥–Ω—è, —Ü–µ–Ω–∞ –∑–∞ —Å–º–µ–Ω—É 3000",
    "–í—ã–π–¥—É –Ω–∞ –∑–∞–º–µ–Ω—É, –∑–∞–≤—Ç—Ä–∞, –æ–ø–ª–∞—Ç–∞ 2500 —Ä—É–±",
    "–ú–æ–≥—É 15 —Ñ–µ–≤—Ä–∞–ª—è, 2800‚ÇΩ, —à–∫ - 100",
    "–†–∞–±–æ—Ç–∞ –ü–í–ó, –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞, 3500, —à–∫ –º–∞–ª–æ",
    "–ò—â—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ –∑–∞–º–µ–Ω—É, –ú—ã—Ç–∏—â–∏, 20 —Ñ–µ–≤—Ä–∞–ª—è, 2800",
    "–ù—É–∂–µ–Ω —Ä–∞–±–æ—Ç–Ω–∏–∫ –≤ –ü–í–ó, –∑–∞–≤—Ç—Ä–∞, –æ–ø–ª–∞—Ç–∞ 3000 —Ä, —à–∫ - 200",
    "15.02 –º–æ–≥—É –≤—ã–π—Ç–∏, –∑–ø 3200, —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤ 150"
]
–í—Å–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–æ–ª–∂–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —ç—Ç–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö!

üéõÔ∏è –§–ò–õ–¨–¢–†–´
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
–ü–∞—Ä–∞–º–µ—Ç—Ä–¢–∏–ø–û–ø–∏—Å–∞–Ω–∏–µmode"worker" / "employer"–†–µ–∂–∏–º –ø–æ–∏—Å–∫–∞date_fromdate–î–∞—Ç–∞ –û–¢date_todate–î–∞—Ç–∞ –î–ûmin_priceint–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞max_priceint–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞shk_filterstring"–ª—é–±–æ–µ" / "100" / "–º–∞–ª–æ"
‚ùå –ù–ï —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –ª–æ–∫–∞—Ü–∏–∏ (—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–ª—ç–Ω–≥–∞ –≤ —á–∞—Ç–∞—Ö)

üîå REST API ENDPOINTS
1. –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
httpPOST /workers/start
Content-Type: application/json

{
  "user_id": 338908929,
  "mode": "worker",  // "worker" –∏–ª–∏ "employer"
  "chats": [
    "@pvz_workers_moscow",
    "@wildberries_rabota"
  ],
  "filters": {
    "date_from": "2026-02-10",
    "date_to": "2026-02-20",
    "min_price": 2000,
    "max_price": 5000,
    "shk_filter": "–ª—é–±–æ–µ"
  },
  "notification_bot_token": "BOT_TOKEN",
  "notification_chat_id": 338908929,
  "parse_history_days": 14
}
Response:
json{
  "task_id": "abc-123-def",
  "status": "pending",
  "message": "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω",
  "started_at": "2026-02-01T15:30:00Z"
}

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
httpGET /workers/status/{task_id}
Response:
json{
  "task_id": "abc-123-def",
  "status": "running",
  "mode": "worker",
  "stats": {
    "total_messages_scanned": 1523,
    "items_found": 47,
    "notifications_sent": 12,
    "last_update": "2026-02-01T16:45:00Z"
  }
}

3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
httpPOST /workers/stop/{task_id}
Response:
json{
  "task_id": "abc-123-def",
  "status": "stopped",
  "message": "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
}

4. –°–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
httpGET /workers/list/{task_id}?limit=50
Response:
json{
  "task_id": "abc-123-def",
  "mode": "worker",
  "total": 47,
  "items": [
    {
      "id": 1,
      "author_username": "@ivan_petrov",
      "date": "2026-02-15",
      "price": 3000,
      "shk": "100",
      "message_link": "https://t.me/...",
      "found_at": "2026-02-01T15:35:00Z"
    }
  ]
}

5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –ß–µ—Ä–Ω—ã–π –°–ø–∏—Å–æ–∫
httpPOST /workers/{item_id}/check-blacklist

{
  "task_id": "abc-123-def"
}
Response:
json{
  "item_id": 1,
  "check_status": "completed",
  "result": {
    "is_blacklisted": false,
    "messages": []
  }
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ—Ç endpoint –ø–æ–∫–∞ **–∑–∞–≥–ª—É—à–∫–∞**. –°–µ—Ä–≤–∏—Å blacklist_service –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø–æ–∑–∂–µ. –°–µ–π—á–∞—Å –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–π `{"is_blacklisted": false}`.

---

## üì¨ –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –í TELEGRAM

### –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—Ä–∞–±–æ—Ç–Ω–∏–∫):
```
üë∑ –ù–æ–≤—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫!

üìÖ –î–∞—Ç–∞: 15 —Ñ–µ–≤—Ä–∞–ª—è 2026
üí∞ –¶–µ–Ω–∞: 3000 —Ä—É–±/—Å–º–µ–Ω—É
üì¶ –®–ö: 100
üìç –õ–æ–∫–∞—Ü–∏—è: –ú—ã—Ç–∏—â–∏
üë§ @ivan_petrov (–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤)
üí¨ –ß–∞—Ç: @pvz_workers_moscow
üîó https://t.me/pvz_workers_moscow/12345

üìù –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç:
"–ì–æ—Ç–æ–≤ –≤—ã–π—Ç–∏ 15 —Ñ–µ–≤—Ä–∞–ª—è, —Ü–µ–Ω–∞ 3000, —à–∫ 100, –ú—ã—Ç–∏—â–∏"

[–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –ß–°] [–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å]
```

### –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å):
```
üè¢ –ù–æ–≤–∞—è –≤–∞–∫–∞–Ω—Å–∏—è!

üìÖ –î–∞—Ç–∞: 20 —Ñ–µ–≤—Ä–∞–ª—è 2026
üí∞ –û–ø–ª–∞—Ç–∞: 2800 —Ä—É–±/—Å–º–µ–Ω—É
üì¶ –®–ö: 200
üìç –õ–æ–∫–∞—Ü–∏—è: –õ—é–±–µ—Ä—Ü—ã
üë§ @employer_user
üí¨ –ß–∞—Ç: @pvz_jobs
üîó https://t.me/pvz_jobs/67890

üìù –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç:
"–ò—â—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ –∑–∞–º–µ–Ω—É, –õ—é–±–µ—Ä—Ü—ã, 20 —Ñ–µ–≤—Ä–∞–ª—è, 2800, —à–∫ 200"

[–°–≤—è–∑–∞—Ç—å—Å—è] [–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å]
–û—Ç–ø—Ä–∞–≤–ª—è–π —á–µ—Ä–µ–∑ python-telegram-bot –≤ –±–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–∫–µ–Ω –∏ chat_id –∏–∑ –∑–∞–ø—Ä–æ—Å–∞).

üíæ –ë–ê–ó–ê –î–ê–ù–ù–´–• (SQLite)
–¢–∞–±–ª–∏—Ü–∞: found_items
sqlCREATE TABLE found_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    task_id TEXT NOT NULL,
    mode TEXT NOT NULL,
    author_username TEXT,
    author_full_name TEXT,
    date TEXT NOT NULL,
    price INTEGER NOT NULL,
    shk TEXT,
    location TEXT,
    message_text TEXT NOT NULL,
    message_link TEXT NOT NULL,
    chat_name TEXT NOT NULL,
    message_date TEXT NOT NULL,
    found_at TEXT NOT NULL,
    notified BOOLEAN DEFAULT 0
);
–¢–∞–±–ª–∏—Ü–∞: tasks
sqlCREATE TABLE tasks (
    task_id TEXT PRIMARY KEY,
    user_id INTEGER NOT NULL,
    mode TEXT NOT NULL,
    chats TEXT NOT NULL,
    filters TEXT NOT NULL,
    notification_bot_token TEXT NOT NULL,
    notification_chat_id INTEGER NOT NULL,
    status TEXT NOT NULL,
    created_at TEXT NOT NULL,
    stopped_at TEXT
);

üîÑ –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´ (–ø–æ—à–∞–≥–æ–≤–æ)

API –ø–æ–ª—É—á–∞–µ—Ç POST /workers/start

–°–æ–∑–¥–∞—ë—Ç task_id (UUID)
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –ë–î
–ó–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É (threading)


–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞:

–ß–∏—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 14 –¥–Ω–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è)
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä—ã (—Ä–∞–±–æ—Ç–Ω–∏–∫/—Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å)
–ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (regex)
–ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã
–ï—Å–ª–∏ –ø–æ–¥—Ö–æ–¥–∏—Ç:

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ found_items
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ






–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–∫–∏
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –ß–°":

(–ü–û–ö–ê –ó–ê–ì–õ–£–®–ö–ê) –ü—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {"is_blacklisted": false}




üß© –í–ê–ñ–ù–´–ï –î–ï–¢–ê–õ–ò –†–ï–ê–õ–ò–ó–ê–¶–ò–ò
1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ (state_manager.py)
–•—Ä–∞–Ω–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞—á –≤ –ø–∞–º—è—Ç–∏ (—Å–ª–æ–≤–∞—Ä—å):
pythontasks = {
    "abc-123": {
        "task_id": "abc-123",
        "status": "running",
        "stop_event": threading.Event(),
        "stats": {...}
    }
}
2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏
–ü—Ä–∏ POST /workers/stop/{task_id}:

–£—Å—Ç–∞–Ω–æ–≤–∏ stop_event.set()
–§–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç stop_event.is_set() –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

3. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
–ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–≤–∞–∂–¥—ã:

–ü—Ä–æ–≤–µ—Ä—è–π message_link –≤ –ë–î –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
–ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏

4. Telegram —á—Ç–µ–Ω–∏–µ (python-telegram-bot)
–ò—Å–ø–æ–ª—å–∑—É–π Bot API –¥–ª—è —á—Ç–µ–Ω–∏—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤:
pythonfrom telegram import Bot

bot = Bot(token="BOT_TOKEN")

# –ß—Ç–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
updates = await bot.get_updates()

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–∞
chat = await bot.get_chat("@pvz_workers_moscow")
```

**–í–∞–∂–Ω–æ:** Bot API **–Ω–µ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã**. –ù–æ –ø–æ –¢–ó –≤—Å–µ —á–∞—Ç—ã **–ø—É–±–ª–∏—á–Ω—ã–µ**, —Ç–∞–∫ —á—Ç–æ —ç—Ç–æ OK.

---

## üì¶ requirements.txt
```
fastapi==0.109.0
uvicorn[standard]==0.27.0
pydantic==2.5.3
python-telegram-bot==21.0
loguru==0.7.2
aiosqlite==0.19.0
python-dateutil==2.8.2

üß™ –ö–ê–ö –¢–ï–°–¢–ò–†–û–í–ê–¢–¨
1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞:
bashpython api.py
2. –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:
bashcurl -X POST http://localhost:8002/workers/start \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 338908929,
    "mode": "worker",
    "chats": ["@test_channel"],
    "filters": {
      "date_from": "2026-02-10",
      "date_to": "2026-02-20",
      "min_price": 2000,
      "max_price": 5000,
      "shk_filter": "–ª—é–±–æ–µ"
    },
    "notification_bot_token": "TEST_TOKEN",
    "notification_chat_id": 338908929,
    "parse_history_days": 14
  }'
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
bashcurl http://localhost:8002/workers/status/{task_id}

‚úÖ –ß–ï–ö–õ–ò–°–¢ –ì–û–¢–û–í–ù–û–°–¢–ò

 API –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8002
 Swagger UI –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ /docs
 POST /workers/start —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É
 –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ —á–∏—Ç–∞–µ—Ç Telegram —á–∞—Ç—ã
 Regex –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
 –§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç (–¥–∞—Ç–∞, —Ü–µ–Ω–∞, –®–ö)
 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram
 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
 –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ—Ç –ø–æ–≤—Ç–æ—Ä–æ–≤)
 POST /workers/stop –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–¥–∞—á—É
 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (loguru) –≤ –∫–æ–Ω—Å–æ–ª—å


üéØ –ò–¢–û–ì
–°–æ–∑–¥–∞–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å workers_service –∫–æ—Ç–æ—Ä—ã–π:

‚úÖ –ò–º–µ–µ—Ç REST API (FastAPI)
‚úÖ –ß–∏—Ç–∞–µ—Ç Telegram —á–∞—Ç—ã (python-telegram-bot)
‚úÖ –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (regex)
‚úÖ –§–∏–ª—å—Ç—Ä—É–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è
‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚úÖ –•—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (SQLite)
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ (threading)
‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ParserHub –±–æ—Ç–æ–º (–∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø–æ–∑–∂–µ)

ParserHub –±–æ—Ç –ù–ï –Ω—É–∂–µ–Ω —Å–µ–π—á–∞—Å ‚Äî –º—ã —Å–æ–∑–¥–∞—ë–º —Ç–æ–ª—å–∫–æ API!


–í–æ—Ç –µ—â–µ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–±–µ –º–æ–≥—É—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è:
dto.py (—ç—Ç–æ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ "avito_cian_parser")
from dataclasses import dataclass, field
from typing import List, Optional


@dataclass
class Proxy:
    proxy_string: str
    change_ip_link: str


@dataclass
class ProxySplit:
    ip_port: str
    login: str
    password: str
    change_ip_link: str


@dataclass
class AvitoConfig:
    urls: List[str]
    proxy_string: Optional[str] = None
    proxy_change_url: Optional[str] = None
    keys_word_white_list: List[str] = field(default_factory=list)
    keys_word_black_list: List[str] = field(default_factory=list)
    seller_black_list: List[str] = field(default_factory=list)
    count: int = 1
    tg_token: Optional[str] = None
    tg_chat_id: List[str] = None
    vk_token: Optional[str] = None
    vk_user_id: List[str] = None
    max_price: int = 999_999_999
    min_price: int = 0
    geo: Optional[str] = None
    max_age: int = 24 * 60 * 60
    debug_mode: int = 0
    pause_general: int = 60
    pause_between_links: int = 5
    max_count_of_retry: int = 5
    ignore_reserv: bool = True
    ignore_promotion: bool = False
    one_time_start: bool = False
    one_file_for_link: bool = False
    parse_views: bool = False
    save_xlsx: bool = True
    use_webdriver: bool = True


@dataclass
class CianConfig:
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞ –¶–∏–∞–Ω"""
    urls: List[str]
    deal_type: str = "rent_long"  # "rent_long" –∏–ª–∏ "sale"
    location: str = "–ú–æ—Å–∫–≤–∞"

    # –§–∏–ª—å—Ç—Ä—ã
    keys_word_white_list: List[str] = field(default_factory=list)
    keys_word_black_list: List[str] = field(default_factory=list)
    seller_black_list: List[str] = field(default_factory=list)
    max_price: int = 999_999_999
    min_price: int = 0
    min_area: int = 0  # –ù–û–í–û–ï - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å
    max_area: int = 999_999  # –ù–û–í–û–ï - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å
    geo: Optional[str] = None
    max_age: int = 0  # –≤ —Å–µ–∫—É–Ω–¥–∞—Ö, 0 = –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
    count: int = 1  # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
    pause_general: int = 60
    pause_between_links: int = 5
    max_count_of_retry: int = 5
    use_webdriver: bool = True

    # –ü—Ä–æ–∫—Å–∏
    proxy_string: Optional[str] = None
    proxy_change_url: Optional[str] = None

    # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–µ —Å Avito)
    tg_token: Optional[str] = None
    tg_chat_id: List[str] = None
    vk_token: Optional[str] = None
    vk_user_id: List[str] = None

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    save_xlsx: bool = True
    one_time_start: bool = False


–í–æ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ avito_cian_parser:
fastapi==0.109.0
uvicorn[standard]==0.27.0
pydantic==2.5.3
loguru==0.7.2

# –£–∂–µ –µ—Å—Ç—å (–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞):
curl-cffi
beautifulsoup4
openpyxl
pydantic
requests
tomli-w
tzlocal
playwright
playwright-stealth
httpx